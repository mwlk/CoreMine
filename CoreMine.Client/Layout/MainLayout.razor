@inherits LayoutComponentBase
@using CoreMine.Client.Services
@inject ThemeService ThemeService

<div class="@($"d-flex flex-column min-vh-100 {(darkMode ? "bg-dark text-white" : "bg-light text-dark")}")">

    <header class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <button class="btn btn-outline-light me-2" @onclick="ToggleDrawer">☰</button>
            <a class="navbar-brand" href="#">CoreMine</a>
            <div class="ms-auto">
                <button class="btn btn-outline-light" @onclick="ToggleDarkMode">
                    @(darkMode ? "🌞" : "🌙")
                </button>
            </div>
        </div>
    </header>

    <div class="d-flex flex-grow-1">

        @if (drawerOpen)
        {
            <nav class="bg-secondary p-3" style="width: 200px;">
                <NavMenu />
            </nav>
        }

        <main class="flex-grow-1 p-4" style="background-color:@(darkMode ? "#121212" : "#fafafa")">
            @Body
        </main>

    </div>
</div>

@code {
    private bool darkMode;
    private bool drawerOpen = true;

    protected override void OnInitialized()
    {
        darkMode = ThemeService.IsDarkMode;
        ThemeService.OnThemeChanged += ChangeTheme;
    }

    private void ToggleDarkMode()
    {
        ThemeService.ToggleTheme();
    }

    private void ToggleDrawer()
    {
        drawerOpen = !drawerOpen;
    }

    private void ChangeTheme()
    {
        darkMode = ThemeService.IsDarkMode;
        StateHasChanged();
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= ChangeTheme;
    }
}
